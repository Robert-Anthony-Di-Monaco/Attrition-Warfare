<behavior-tree>
  
  <selector>

    <!-- sequence for having an attack move order on a unit within range -->
    <sequence>
      <condition name = "has-move-order"/>
      <condition name = "is-order-attack-order"/>
      <condition name = "is-target-a-unit"/>
      <condition name = "is-target-unit-in-range"/>
      <condition name = "is-facing-target"/>
      <leaf name = "shoot-target"/>
    </sequence>

    
    <!-- sequence for having an attack move order on a unit within range -->
    <sequence>
      <condition name = "has-move-order"/>
      <condition name = "is-order-attack-order"/>
      <condition name = "is-target-a-unit"/>
      <condition name = "is-target-unit-in-range"/>
      <not>
        <condition name = "is-facing-target"/>
      </not>
      <leaf name = "face-target"/>
    </sequence>
   

    <!-- sequence for having an attack move order on a unit NOT in range -->
    <sequence>
      <condition name = "has-move-order"/>
      <condition name = "is-order-attack-order"/>
      <condition name = "is-target-a-unit"/>
      <not>
        <condition name = "is-target-unit-in-range"/>
      </not>
      <leaf name = "move-to-target"/>
    </sequence>

    <!-- sequence for move attack order targeting the ground but there is an enemy within attacking range so act aggressively towards it -->
    <sequence>
      <condition name = "has-move-order"/>
      <condition name = "is-order-attack-order"/>
      <not>
        <condition name = "is-target-a-unit"/>
      </not>
      <condition name = "is-enemy-in-attack-range"/>
      <condition name = "is-facings-nearest-enemy"/>
      <leaf name = "shoot-nearest-enemy" />
    </sequence>
    

    <!-- sequence for an attack move order targeted on the ground but there is an enemy in attack range so we act aggressively towards it -->
    <sequence>
      <condition name = "has-move-order"/>
      <condition name = "is-order-attack-order"/>
      <not>
        <condition name = "is-target-a-unit"/>
      </not>
      <condition name = "is-enemy-in-attack-range"/>
      <not>
        <condition name = "is-facings-nearest-enemy"/>
      </not>
      <leaf name = "face-nearest-enemy" /> 
    </sequence>
    
    
    <!-- sequence for an attack move order targeting the ground + there no enemies in rang so move towards target location -->
    <sequence>
      <condition name = "has-move-order"/>
      <condition name = "is-order-attack-order"/>
      <not>
        <condition name = "is-target-a-unit"/>
      </not>
      <not>
        <condition name = "is-enemy-in-attack-range"/>
      </not>
      <leaf name = "move-to-target" />
    </sequence>


    <!-- here is the sequence for having a move order that is not an attack move order so we ignore everything else and move to our target -->
    <sequence>
      <condition name = "has-move-order"/>
      <not>
        <condition name = "is-order-attack-order"/>
      </not>
      <leaf name = "move-to-target"/>
    </sequence>

    <!-- here is the sequence where we currently dont have an order and we are commanding a squad so we move with the squad anchor-->
    <sequence>
      <not>
        <condition name = "has-move-order"/>
      </not>
      <condition name = "is-commanding-squad"/>
      <leaf name = "idle" />
    </sequence>

    <!-- here is the sequence for when we dont have a move order and we are not currently leading a squad but an enemy is in range so we attack him -->
    <sequence>
      <not>
        <condition name = "has-move-order"/>
      </not>
      <not>
        <condition name = "is-commanding-squad"/>
      </not>
      <condition name = "is-enemy-in-attack-range"/>
      <condition name = "is-facings-nearest-enemy"/>
      <leaf name = "shoot-nearest-enemy" />
    </sequence>
    

    
    <!-- sequence for NO move order + NOT leading a squad but an enemy within range so attack them -->
    <sequence>
      <not>
        <condition name = "has-move-order"/>
      </not>
      <not>
        <condition name = "is-commanding-squad"/>
      </not>
      <condition name = "is-enemy-in-attack-range"/>
      <not>
        <condition name = "is-facings-nearest-enemy"/>
      </not>
      <leaf name = "face-nearest-enemy" /> 
    </sequence>
    
    <!-- sequence for NO move order + NOT currently leading a squad and no enemies within range -->
    <sequence>
      <not>
        <condition name = "has-move-order"/>
      </not>
      <not>
        <condition name = "is-commanding-squad"/>
      </not>
      <not>
        <condition name = "is-enemy-in-attack-range"/>
      </not>
      <leaf name = "idle" />
    </sequence>

  </selector>
  
</behavior-tree>